local L4 = require("L4");
local ld = L4.default_loader;
local server = ld:new_channel();
local vbus = ld:new_channel();
local fbdrv = ld:new_channel();

ld:start({ caps = { server = server:svr() }, log = { "server", "red"}}, "rom/my_pkg_server");
ld:start({ caps = { server = server:create(0, "client1"), fb = fbdrv }, log = { "client1", "green"}}, "rom/my_pkg_client");
--ld:start({ caps = { server = server:create(0, "client2") }, log = { "client2", "green"}}, "rom/my_pkg_client");

ld:start({ caps = 
           { fbdrv = vbus:svr(), 
             icu = L4.Env.icu,
             sigma0 = L4.cast(L4.Proto.Factory, L4.Env.sigma0):create(L4.Proto.Sigma0)}, 
           --log = {"IO", "yellow" }
           },
          "rom/io rom/x86-legacy.devs rom/x86-fb.io");

ld:start({ caps = { vbus = vbus, fb = fbdrv:srv() },
           log = { "fbdrv", "blue"} },
         "rom/fb-drv -m 0x117");

--ld:start({ caps = { fb = fbdrv}}, "rom/fb_client");